using System.Numerics;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;
using Robust.Client.UserInterface;
using Content.Shared.DeltaV.Arcade.S3D;
using FancyWindow = Content.Client.UserInterface.Controls.FancyWindow;
using Content.Client.DeltaV.Arcade.S3D.Renderer;

namespace Content.Client.DeltaV.Arcade.S3D.UI;

[GenerateTypedNameReferences]
public sealed partial class S3DMenu : FancyWindow
{
    [Dependency] private readonly IEntityManager _entMan = default!;
    private readonly S3DBoundUserInterface _owner;
    public S3DMenu(S3DBoundUserInterface owner)
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);

        _owner = owner;

        if (_entMan.TryGetComponent<S3DArcadeComponent>(owner.Owner, out var comp))
        {
            MainScreen.AddChild(NewRenderer(comp));
        }
    }
    protected override void KeyBindDown(GUIBoundKeyEventArgs args)
    {
        base.KeyBindDown(args);

        _owner.RegisterKeyPress(args.Function);
    }

    protected override void KeyBindUp(GUIBoundKeyEventArgs args)
    {
        base.KeyBindUp(args);

        _owner.UnregisterKeyPress(args.Function);
    }

    private S3DRenderer NewRenderer(S3DArcadeComponent component)
    {
        var renderer = _entMan.EntitySysManager.GetEntitySystem<S3DArcadeSystem>().NewRenderer(component);
        renderer.SetSize = new Vector2(640, 480);
        renderer.CanKeyboardFocus = true;
        renderer.KeyboardFocusOnClick = true;
        return renderer;
    }
}
